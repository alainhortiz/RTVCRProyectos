{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('easyadmin/tema/DataTables-1.10.10/media/css/jquery.dataTables.css') }}"/>
{% endblock %}

{% block body %}
    <!-- Alerta -->
    <div class="preload hidden">
        <div class="logo"></div>
        <div class="loader-frame">
            <div class="loader1" id="loader1"></div>
            <div class="loader2" id="loader2"></div>
        </div>
    </div>
    <!-- Header -->
    <div class="header bg-primary pb-6">
        <div class="container-fluid">
            <div class="header-body">
                <!-- Card stats -->
            </div>
        </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card card-user">
                    <div class="card-header">
                        <h2 class="card-title text-info font-weight-bold mb-4" id="nameProyecto">No. Contrato Canal:  {{ proyecto.noContratoCanal ~ ' -' ~ ' ' ~ proyecto.titulo }}</h2>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="row justify-content-center">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <!-- Tabs with icons -->
                                    <div class="nav-wrapper">
                                        <ul class="nav nav-pills nav-fill flex-column flex-md-row" id="tabs-icons-text"
                                            role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link mb-sm-3 mb-md-0 active" id="tabs-icons-text-1-tab"
                                                   data-toggle="tab" href="#tabs-icons-text-1" role="tab"
                                                   aria-controls="tabs-icons-text-1" aria-selected="true"><i
                                                            class="ni ni-single-copy-04 mr-2"></i>Generales</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link mb-sm-3 mb-md-0" id="tabs-icons-text-2-tab"
                                                   data-toggle="tab" href="#tabs-icons-text-2" role="tab"
                                                   aria-controls="tabs-icons-text-2" aria-selected="false"><i
                                                            class="ni ni-single-02 mr-2"></i>Contrataciones al personal artístico</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link mb-sm-3 mb-md-0" id="tabs-icons-text-3-tab"
                                                   data-toggle="tab" href="#tabs-icons-text-3" role="tab"
                                                   aria-controls="tabs-icons-text-3" aria-selected="false"><i
                                                            class="ni ni-single-02 mr-2"></i>Contrataciones a los trabajadores por cuenta propia</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card shadow">
                                        <div class="card-body" style="background: #fdfdfd">
                                            <div class="tab-content" id="myTabContent">
                                                <div class="tab-pane fade show active" id="tabs-icons-text-1"
                                                     role="tabpanel" aria-labelledby="tabs-icons-text-1-tab">
                                                    <div class="row">
                                                        <div class="col-md-2">
                                                            <div class="form-group">
                                                                <label for="editContratoCanal">No. Contrato</label>
                                                                <input type="text" class="form-control"
                                                                       id="editContratoCanal"
                                                                       name="editContratoCanal"
                                                                       value="{{ proyecto.noContratoCanal }}" disabled>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-5 col-10">
                                                            <div class="form-group">
                                                                <label for="editNombreDirector">Director
                                                                    General</label>
                                                                <input type="text" class="form-control"
                                                                       id="editNombreDirector"
                                                                       name="editNombreDirector"
                                                                       value="{{ proyecto.nombresDirectorGeneral }}"
                                                                       readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-5 col-10">
                                                            <div class="form-group">
                                                                <label for="editNombreProductor">Productor
                                                                    General</label>
                                                                <input type="text" class="form-control"
                                                                       id="editNombreProductor"
                                                                       name="editNombreProductor"
                                                                       value="{{ proyecto.nombresProductorGeneral }}"
                                                                       readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <label for="editTitulo">Título</label>
                                                                <input type="text"
                                                                       class="form-control"
                                                                       id="editTitulo"
                                                                       name="editTitulo" value="{{ proyecto.titulo }}" disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-5 pr-1">
                                                            <div class="form-group">
                                                                <label for="editFormatoProyecto">Formato</label>
                                                                <select
                                                                        class="form-control"
                                                                        id="editFormatoProyecto"
                                                                        name="editFormatoProyecto" disabled>
                                                                    <option value="{{ proyecto.formato.id }}">{{ proyecto.formato.nombre }}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3 px-1">
                                                            <div class="form-group">
                                                                <label>Cantidad de emisiones</label>
                                                                <label for="editEmisiones"></label><input
                                                                        type="number"
                                                                        class="form-control"
                                                                        id="editEmisiones"
                                                                        name="editEmisiones"
                                                                        min="1" value="{{ proyecto.emisiones }}" disabled>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label for="editTiempoPantalla">Tiempo en pantalla</label><input
                                                                        type="number" class="form-control"
                                                                        id="editTiempoPantalla"
                                                                        name="editTiempoPantalla" min="1" value="{{ proyecto.tiempoPantalla }}" disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-4 pr-1">
                                                            <div class="form-group">
                                                                <label>Categoría</label>
                                                                <label for="editTipoProyecto"></label><select
                                                                        class="form-control"
                                                                        id="editTipoProyecto"
                                                                        name="editTipoProyecto" disabled>
                                                                    <option value="{{ proyecto.tipo.id }}">{{ proyecto.tipo.nombre }}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label for="editFechaInicio">Fecha de inicio</label><input
                                                                        type="date"
                                                                        class="form-control"
                                                                        min="2020-01-01"
                                                                        step="1"
                                                                        id="editFechaInicio"
                                                                        name="editFechaInicio" value="{{ proyecto.fechaInicio|date('Y-m-d') }}" disabled>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label for="editFechaFinal">Fecha de terminación</label><input
                                                                        type="date"
                                                                        class="form-control"
                                                                        min="2020-01-01"
                                                                        step="1"
                                                                        id="editFechaFinal"
                                                                        name="editFechaFinal" value="{{ proyecto.fechaTerminacion|date('Y-m-d') }}" disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-4 pr-1">
                                                            <div class="form-group">
                                                                <label for="editPreFilmacion">Etapa Pre-Filmación</label><input
                                                                        type="number" class="form-control"
                                                                        id="editPreFilmacion"
                                                                        name="editPreFilmacion" value="{{ proyecto.etapaPreFilmacion }}" disabled>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 px-1">
                                                            <div class="form-group">
                                                                <label for="editFilmacion">Etapa Filmación</label><input
                                                                        type="number"
                                                                        class="form-control"
                                                                        id="editFilmacion"
                                                                        name="editFilmacion" value="{{ proyecto.etapaFilmacion }}" disabled>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label for="editPostFilmacion">Etapa Post-Filmación</label><input
                                                                        type="number" class="form-control"
                                                                        id="editPostFilmacion"
                                                                        name="editPostFilmacion" value="{{ proyecto.etapaPostFilmacion }}" disabled>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <label for="editDescripcion">Descripción</label><textarea
                                                                        class="form-control textarea"
                                                                        id="editDescripcion"
                                                                        name="editDescripcion" disabled>{{ proyecto.descripcion }}</textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="tabs-icons-text-2" role="tabpanel"
                                                     aria-labelledby="tabs-icons-text-2-tab">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="table-responsive">
                                                                    <table class="table align-items-center table-flush"
                                                                           id="dataPA">
                                                                        <thead style="background: #1c345d;color: white">
                                                                        <tr>
                                                                            <th scope="col">No.</th>
                                                                            <th scope="col">CI</th>
                                                                            <th scope="col">Nombres</th>
                                                                            <th scope="col">Concepto</th>
                                                                            <th scope="col" class="text-center">Por cargo</th>
                                                                            <th scope="col" class="text-center">Otros ingresos</th>
                                                                            <th scope="col" class="text-center">Total a cobrar</th>
                                                                            <th scope="col" class="text-center">Valor por programa</th>
                                                                            <th scope="col" class="text-center">
                                                                                Contratos
                                                                            </th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody class="list">
                                                                        {% for proye in proyecto.proyectosPersonasCargos() if proye.isPA == true %}
                                                                            <tr data-id="{{ proye.id }}">
                                                                                <td>{{ proye.noContrato }}</td>
                                                                                <td>{{ proye.persona.carnetIdentidad }}</td>
                                                                                <td>{{ proye.persona.nombreCompleto }}</td>
                                                                                <td>{{ proye.cargo.nombre }}</td>
                                                                                <td class="text-center">{{ proye.presupuestoCargo|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">{{ proye.presupuestoOtroIngreso|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">{{ proye.presupuestoTotal|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">{{ proye.valorPrograma|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">
                                                                                    <a href="{{ path('exportarContrato',{idProyectoCargo:proye.id}) }}" class="btn btn-sm btn-info btn-icon-only rounded-circle exportarContratoPA" data-toggle="tooltip" data-placement="top" title="Generar Contrato"><span class="btn-inner--icon"><i class="fas fa-file-word"></i></span></a>
                                                                                </td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="tabs-icons-text-3" role="tabpanel"
                                                     aria-labelledby="tabs-icons-text-3-tab">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="table-responsive">
                                                                    <table class="table align-items-center table-flush"
                                                                           id="dataTCP">
                                                                        <thead style="background: #1c345d;color: white">
                                                                        <tr>
                                                                            <th scope="col">No.</th>
                                                                            <th scope="col">CI</th>
                                                                            <th scope="col">Nombres</th>
                                                                            <th scope="col">Concepto</th>
                                                                            <th scope="col" class="text-center">Por cargo</th>
                                                                            <th scope="col" class="text-center">Total a cobrar</th>
                                                                            <th scope="col" class="text-center">Valor por programa</th>
                                                                            <th scope="col" class="text-center">
                                                                                Contratos
                                                                            </th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody class="list">
                                                                        {% for proye in proyecto.proyectosPersonasCargos() if proye.isTCP == true %}
                                                                            <tr data-id="{{ proye.id }}">
                                                                                <td>{{ proye.noContrato }}</td>
                                                                                <td>{{ proye.persona.carnetIdentidad }}</td>
                                                                                <td>{{ proye.persona.nombreCompleto }}</td>
                                                                                <td>{{ proye.cargo.nombre }}</td>
                                                                                <td class="text-center">{{ proye.presupuestoCargo|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">{{ proye.presupuestoTotal|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">{{ proye.valorPrograma|number_format(2, '.', ',') }}</td>
                                                                                <td class="text-center">
                                                                                    <a href="{{ path('exportarContrato',{idProyectoCargo:proye.id}) }}" class="btn btn-sm btn-info btn-icon-only rounded-circle exportarContratoTCP" data-toggle="tooltip" data-placement="top" title="Generar Contrato"><span class="btn-inner--icon"><i class="fas fa-file-word"></i></span></a>
                                                                                </td>
                                                                            </tr>
                                                                        {% endfor %}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="update ml-auto mr-auto">
                                        <button type="button" class="btn btn-secondary btn-round"
                                                id="btnCancelar"
                                                data-toggle="tooltip"
                                                data-placement="top"
                                                title="Salir">Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% block footer %}
            {{ parent() }}
        {% endblock %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- BEGIN GRAFICOS HIGHSTOCK LEVEL PLUGINS -->
    <script src="{{ asset('easyadmin/plugins/highstock/code/highstock.js') }}"></script>
    <!-- END  GRAFICOS HIGHSTOCK LEVEL PLUGINS -->
    <script src="{{ asset('easyadmin/tema/DataTables-1.10.10/media/js/jquery.dataTables.js') }}"></script>
    <script>
        $(document).ready(function () {

            (function(){
                {% if not (is_granted("ROLE_PROYECTO") or is_granted("ROLE_SUPERUSUARIO")) %}
                window.location.href = "{{ path('login') }}";
                {% endif %}
            })();

            $('#dataPA').DataTable({
                "lengthChange": false,
                "scrollY":        "400px",
                "scrollCollapse": true,
                "paging":         false
            });

            $('#dataTCP').DataTable({
                "lengthChange": false,
                "scrollY":        "400px",
                "scrollCollapse": true,
                "paging":         false
            });

            //--------- abandonar el formulario -----------------
            $('#btnCancelar').on('click', function () {
                window.location.href = "{{ path('gestionarProyectos') }}";
            });

        });
    </script>
{% endblock %}

